<section class="blog-section" id="blog">
  <div class="container">
    <div class="section-header">
      <h2 class="section-title">Latest from the Blog</h2>
      <p class="section-subtitle">Stay updated with the latest insights and news</p>
    </div>
    
    <!-- Loading state -->
    <div id="blog-loading" class="blog-loading">
      <p>Loading latest articles...</p>
    </div>
    
    <!-- Error state -->
    <div id="blog-error" class="blog-error" style="display: none;">
      <p>Unable to load articles. Showing static content instead.</p>
    </div>
    
    <!-- Dynamic blog grid (populated by JavaScript) -->
    <div id="blog-grid" class="blog-grid" style="display: none;">
      <!-- Articles will be loaded here via JavaScript -->
    </div>
    
    <!-- Fallback static content (hidden by default) -->
    <div id="blog-fallback" class="blog-grid" style="display: none;">
      {% for post in site.data.blog.posts %}
        <article class="blog-card" data-aos="fade-up" data-aos-delay="{{ forloop.index0 | times: 100 }}">
          <div class="blog-card-image">
            <img src="{{ post.image | relative_url }}" alt="{{ post.title }}" loading="lazy">
            <div class="blog-card-overlay">
              <a href="{{ post.link }}" target="_blank" rel="noopener" class="blog-card-link">
                Read More
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M7 17L17 7M17 7H7M17 7V17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </a>
            </div>
          </div>
          <div class="blog-card-content">
            <div class="blog-card-meta">
              <span class="blog-card-date">{{ post.date | date: "%B %d, %Y" }}</span>
            </div>
            <h3 class="blog-card-title">{{ post.title }}</h3>
          </div>
        </article>
      {% endfor %}
    </div>
  </div>
</section>

<script>
// Blog API Integration
document.addEventListener('DOMContentLoaded', function() {
  const blogGrid = document.getElementById('blog-grid');
  const blogLoading = document.getElementById('blog-loading');
  const blogError = document.getElementById('blog-error');
  const blogFallback = document.getElementById('blog-fallback');
  
  // API endpoint for articles
  const API_ENDPOINT = 'https://nearweek.com/api/articles';
  
  // Function to format date
  function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('en-US', { 
      year: 'numeric', 
      month: 'long', 
      day: 'numeric' 
    });
  }
  
  // Function to create blog card HTML
  function createBlogCard(article, index) {
    return `
      <article class="blog-card" data-aos="fade-up" data-aos-delay="${index * 100}">
        <div class="blog-card-image">
          <img src="${article.image || '/images/default-article.jpg'}" alt="${article.title}" loading="lazy">
          <div class="blog-card-overlay">
            <a href="${article.link}" target="_blank" rel="noopener" class="blog-card-link">
              Read More
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M7 17L17 7M17 7H7M17 7V17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </a>
          </div>
        </div>
        <div class="blog-card-content">
          <div class="blog-card-meta">
            <span class="blog-card-date">${formatDate(article.date)}</span>
          </div>
          <h3 class="blog-card-title">${article.title}</h3>
        </div>
      </article>
    `;
  }
  
  // Function to load articles from API
  async function loadArticles() {
    try {
      const response = await fetch(API_ENDPOINT);
      
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      
      const data = await response.json();
      
      // Handle both single article and array of articles
      const articles = Array.isArray(data) ? data : [data];
      
      if (articles.length === 0) {
        throw new Error('No articles found');
      }
      
      // Hide loading, show grid
      blogLoading.style.display = 'none';
      blogGrid.style.display = 'block';
      
      // Populate the grid
      blogGrid.innerHTML = articles.map((article, index) => 
        createBlogCard(article, index)
      ).join('');
      
      // Re-initialize AOS if available
      if (typeof AOS !== 'undefined') {
        AOS.refresh();
      }
      
    } catch (error) {
      console.error('Error loading articles:', error);
      
      // Hide loading, show error, then fallback
      blogLoading.style.display = 'none';
      blogError.style.display = 'block';
      
      // After 2 seconds, show fallback content
      setTimeout(() => {
        blogError.style.display = 'none';
        blogFallback.style.display = 'block';
      }, 2000);
    }
  }
  
  // Load articles when page loads
  loadArticles();
});
</script>

<style>
.blog-loading, .blog-error {
  text-align: center;
  padding: 2rem;
  color: #666;
}

.blog-loading p, .blog-error p {
  margin: 0;
  font-size: 1.1rem;
}
</style>
